# ุฅุตูุงุญ ูุดููุฉ ุงูุญูุธ ุงููุคูุช - ุชุญุฏูุซ ุจุฏูุงู ูู ุฅูุดุงุก ุฌุฏูุฏ

## ุงููุดููุฉ
ูุงู ุงูุญูุธ ุงููุคูุช ูููู ุจุฅูุดุงุก ุฒูุงุฑุฉ ุฌุฏูุฏุฉ ูู ูู ูุฑุฉ ุจุฏูุงู ูู ุชุญุฏูุซ ุงูุฒูุงุฑุฉ ุงูููุฌูุฏุฉ.

## ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุฏูุซ API ุงูุฒูุงุฑุงุช (`/api/visits/route.ts`)
- โ **ุฏุนู ุงูุชุญุฏูุซ**: ุฅุถุงูุฉ ููุทู ููุชุญูู ูู ูุฌูุฏ `data.id`
- โ **ุฅูุดุงุก ุฃู ุชุญุฏูุซ**: ุฅุฐุง ูุงู ููุงู IDุ ูุชู ุงูุชุญุฏูุซุ ูุฅูุง ูุชู ุงูุฅูุดุงุก
- โ **ุชุณุฌูู ููุตู**: ุชุณุฌูู ูุง ุฅุฐุง ูุงู ุฅูุดุงุก ุฃู ุชุญุฏูุซ

```typescript
// Check if this is an update (has ID) or create new
if (data.id) {
  console.log('๐ Visits API: Updating existing visit:', data.id)
  visit = await prisma.visit.update({
    where: { id: data.id },
    data: visitData,
    // ... include relations
  })
} else {
  console.log('๐ Visits API: Creating new visit with data:', visitData)
  visit = await prisma.visit.create({
    data: visitData,
    // ... include relations
  })
}
```

### 2. ุฅุถุงูุฉ ุชุชุจุน ID ุงูุฒูุงุฑุฉ ุงูุญุงููุฉ
- โ **State ุฌุฏูุฏ**: `currentVisitId` ูุชุชุจุน ID ุงูุฒูุงุฑุฉ ุงูุญุงููุฉ
- โ **ุญูุธ ID**: ุนูุฏ ุชุญููู ูุณูุฏุฉ ููุฌูุฏุฉ ูู API
- โ **ุงุณุชุฎุฏุงู ID**: ูู `saveDraftToAPI` ู `handleSubmit`

### 3. ุชุญุฏูุซ `loadDraftData`
- โ **ุญูุธ ID**: `setCurrentVisitId(latestDraft.id)` ุนูุฏ ุชุญููู ูู API
- โ **ุชุณุฌูู ููุตู**: ุชุณุฌูู ID ุงูุฒูุงุฑุฉ ุงููุญููุฉ

### 4. ุชุญุฏูุซ `saveDraftToAPI`
- โ **ุฅุฑุณุงู ID**: ุฅุถุงูุฉ `visitData.id = currentVisitId` ุฅุฐุง ูุงู ููุฌูุฏ
- โ **ุชุณุฌูู ููุตู**: ุชุณุฌูู ูุง ุฅุฐุง ูุงู ุชุญุฏูุซ ุฃู ุฅูุดุงุก
- โ **ุญูุธ ID ุงูุฌุฏูุฏ**: ุฅุฐุง ูุงู ุฅูุดุงุก ุฌุฏูุฏ

### 5. ุชุญุฏูุซ `handleSubmit`
- โ **ุฅุฑุณุงู ID**: ุฅุถุงูุฉ `visitData.id = currentVisitId` ุฅุฐุง ูุงู ููุฌูุฏ
- โ **ุชุณุฌูู ููุตู**: ุชุณุฌูู ูุง ุฅุฐุง ูุงู ุชุญุฏูุซ ุฃู ุฅูุดุงุก
- โ **ุญูุธ ID ุงูุฌุฏูุฏ**: ุฅุฐุง ูุงู ุฅูุดุงุก ุฌุฏูุฏ

### 6. ุชุญุฏูุซ `resetForm`
- โ **ูุณุญ ID**: `setCurrentVisitId(null)` ุนูุฏ ุฅุนุงุฏุฉ ุชุนููู ุงูููุฑู

## ุงููุชูุฌุฉ

### ูุจู ุงูุฅุตูุงุญ:
1. โ **ุงูุญูุธ ุงููุคูุช**: ููุดุฆ ุฒูุงุฑุฉ ุฌุฏูุฏุฉ ูู ูู ูุฑุฉ
2. โ **ุชุนุฏุฏ ุงูุฒูุงุฑุงุช**: ุนุฏุฉ ุฒูุงุฑุงุช ูุณูุฏุฉ ูููุณ ุงููุฑูุถ
3. โ **ููุฏุงู ุงูุจูุงูุงุช**: ุงูุจูุงูุงุช ุงูุณุงุจูุฉ ูุง ุชูุญุฏุซ

### ุจุนุฏ ุงูุฅุตูุงุญ:
1. โ **ุงูุญูุธ ุงููุคูุช**: ูุญุฏุซ ุงูุฒูุงุฑุฉ ุงูููุฌูุฏุฉ
2. โ **ุฒูุงุฑุฉ ูุงุญุฏุฉ**: ูุณูุฏุฉ ูุงุญุฏุฉ ููุท ููู ูุฑูุถ
3. โ **ุญูุธ ุงูุจูุงูุงุช**: ุงูุจูุงูุงุช ุชูุญุฏุซ ุจุดูู ุตุญูุญ

## ููููุฉ ุงูุงุฎุชุจุงุฑ

1. **ุฅูุดุงุก ุฒูุงุฑุฉ ุฌุฏูุฏุฉ**:
   - ุงูุชุญ ุงูููุฑู
   - ุงููุฃ ุงูุฎุทูุฉ ุงูุฃููู
   - ุงุญูุธ ูุคูุชุงู โ ูุฌุจ ุฅูุดุงุก ุฒูุงุฑุฉ ุฌุฏูุฏุฉ

2. **ุชุญุฏูุซ ุงูุฒูุงุฑุฉ ุงูููุฌูุฏุฉ**:
   - ุงูุชุญ ุงูููุฑู ูุฑุฉ ุฃุฎุฑู
   - ุงููุฃ ุงูุฎุทูุฉ ุงูุซุงููุฉ
   - ุงุญูุธ ูุคูุชุงู โ ูุฌุจ ุชุญุฏูุซ ุงูุฒูุงุฑุฉ ุงูููุฌูุฏุฉ

3. **ุงูุชุญูู ูู Console**:
   - `๐ Creating new visit` (ูููุฑุฉ ุงูุฃููู)
   - `๐ Updating existing visit: [ID]` (ูููุฑุงุช ุงูุชุงููุฉ)

## ุฑุณุงุฆู Console ุงููุชููุนุฉ

```
๐ Form opened, loading draft data for patient: [ID]
๐ Loading draft from API: [visit data]
๐ Current visit ID set to: [visit ID]
๐พ Saving draft to API for step: 2
๐ Updating existing visit: [visit ID]
โ Visit updated successfully: [visit data]
```
